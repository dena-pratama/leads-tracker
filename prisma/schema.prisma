generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String      @id @default(uuid())
  email     String      @unique
  name      String?
  role      Role        @default(SDR)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  leads     Lead[]      @relation("AssignedLeads")
  workspace Workspace[]
}

model Workspace {
  id               String            @id @default(uuid())
  name             String
  ownerId          String
  createdAt        DateTime          @default(now())
  campaigns        Campaign[]
  leads            Lead[]
  platformAccounts PlatformAccount[]
  owner            User              @relation(fields: [ownerId], references: [id])
}

model PlatformAccount {
  id          String     @id @default(uuid())
  platform    String
  accountId   String
  accessToken String
  tokenExpiry DateTime?
  workspaceId String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  name        String?
  workspace   Workspace? @relation(fields: [workspaceId], references: [id])
}

model Campaign {
  id          String          @id @default(uuid())
  platformId  String
  name        String
  status      String
  workspaceId String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  metrics     AdMetricDaily[]
  workspace   Workspace?      @relation(fields: [workspaceId], references: [id])
  leads       Lead[]
}

model AdMetricDaily {
  id                     String   @id @default(uuid())
  date                   DateTime
  campaignId             String
  spend                  Float    @default(0)
  impressions            Int      @default(0)
  reach                  Int      @default(0)
  clicks                 Int      @default(0) // Link clicks
  leads                  Int      @default(0)
  messagingConversations Int      @default(0)
  ctrAll                 Float    @default(0)
  ctrLink                Float    @default(0)
  cpl                    Float?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  campaign               Campaign @relation(fields: [campaignId], references: [id])

  @@unique([date, campaignId])
}

model Lead {
  id            String              @id @default(uuid())
  platformId    String?
  name          String?
  email         String?
  phone         String?
  leadSource    String?     // 'Database' / Receiver Number
  product       String?     // For 'Leads Potential' input
  notes         String?     // For 'Leads Potential' input
  status        LeadStatus          @default(NEW)
  campaignId    String?
  workspaceId   String?
  assignedToId  String?
  createdAt     DateTime            @default(now())
  leadDate      DateTime            @default(now()) // Actual date of the lead (from import/source)
  updatedAt     DateTime            @updatedAt
  assignedTo    User?               @relation("AssignedLeads", fields: [assignedToId], references: [id])
  campaign      Campaign?           @relation(fields: [campaignId], references: [id])
  workspace     Workspace?          @relation(fields: [workspaceId], references: [id])
  statusHistory LeadStatusHistory[]
}

model LeadStatusHistory {
  id        String     @id @default(uuid())
  leadId    String
  status    LeadStatus
  changedBy String?
  changedAt DateTime   @default(now())
  lead      Lead       @relation(fields: [leadId], references: [id])
}

enum Role {
  ADMIN
  ADVERTISER
  SDR
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  LOST
  WON
  FOLLOW_UP
}
